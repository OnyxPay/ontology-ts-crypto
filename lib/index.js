module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("long")},function(e,t){e.exports=require("big-integer")},function(e,t){e.exports=require("elliptic")},function(e,t){e.exports=require("js-sha3")},function(e,t){e.exports=require("bytebuffer")},function(e,t){e.exports=require("bs58")},function(e,t){e.exports=require("bip39-lite")},function(e,t){e.exports=require("hdkey-secp256r1")},function(e,t){e.exports=require("scrypt-async")},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"sha256",function(){return H}),r.d(n,"md160",function(){return C});var i={};r.r(i),r.d(i,"bigIntToBytes",function(){return B}),r.d(i,"bigIntFromBytes",function(){return P});var s={};r.r(s),r.d(s,"PUSH0",function(){return U}),r.d(s,"PUSHF",function(){return O}),r.d(s,"PUSHBYTES1",function(){return x}),r.d(s,"PUSHBYTES75",function(){return K}),r.d(s,"PUSHDATA1",function(){return k}),r.d(s,"PUSHDATA2",function(){return I}),r.d(s,"PUSHDATA4",function(){return N}),r.d(s,"PUSHM1",function(){return T}),r.d(s,"PUSH1",function(){return L}),r.d(s,"PUSHT",function(){return R}),r.d(s,"PUSH2",function(){return z}),r.d(s,"PUSH3",function(){return J}),r.d(s,"PUSH4",function(){return M}),r.d(s,"PUSH5",function(){return _}),r.d(s,"PUSH6",function(){return j}),r.d(s,"PUSH7",function(){return V}),r.d(s,"PUSH8",function(){return F}),r.d(s,"PUSH9",function(){return q}),r.d(s,"PUSH10",function(){return W}),r.d(s,"PUSH11",function(){return Y}),r.d(s,"PUSH12",function(){return X}),r.d(s,"PUSH13",function(){return G}),r.d(s,"PUSH14",function(){return Z}),r.d(s,"PUSH15",function(){return Q}),r.d(s,"PUSH16",function(){return $}),r.d(s,"NOP",function(){return ee}),r.d(s,"JMP",function(){return te}),r.d(s,"JMPIF",function(){return re}),r.d(s,"JMPIFNOT",function(){return ne}),r.d(s,"CALL",function(){return ie}),r.d(s,"RET",function(){return se}),r.d(s,"APPCALL",function(){return ue}),r.d(s,"SYSCALL",function(){return oe}),r.d(s,"TAILCALL",function(){return ae}),r.d(s,"DUPFROMALTSTACK",function(){return ce}),r.d(s,"TOALTSTACK",function(){return de}),r.d(s,"FROMALTSTACK",function(){return he}),r.d(s,"XDROP",function(){return fe}),r.d(s,"XSWAP",function(){return le}),r.d(s,"XTUCK",function(){return we}),r.d(s,"DEPTH",function(){return Se}),r.d(s,"DROP",function(){return ye}),r.d(s,"DUP",function(){return pe}),r.d(s,"NIP",function(){return me}),r.d(s,"OVER",function(){return Ae}),r.d(s,"PICK",function(){return ge}),r.d(s,"ROLL",function(){return Ee}),r.d(s,"ROT",function(){return be}),r.d(s,"SWAP",function(){return De}),r.d(s,"TUCK",function(){return He}),r.d(s,"CAT",function(){return Ce}),r.d(s,"SUBSTR",function(){return ve}),r.d(s,"LEFT",function(){return Be}),r.d(s,"RIGHT",function(){return Pe}),r.d(s,"SIZE",function(){return Ue}),r.d(s,"INVERT",function(){return Oe}),r.d(s,"AND",function(){return xe}),r.d(s,"OR",function(){return Ke}),r.d(s,"XOR",function(){return ke}),r.d(s,"EQUAL",function(){return Ie}),r.d(s,"INC",function(){return Ne}),r.d(s,"DEC",function(){return Te}),r.d(s,"SIGN",function(){return Le}),r.d(s,"NEGATE",function(){return Re}),r.d(s,"ABS",function(){return ze}),r.d(s,"NOT",function(){return Je}),r.d(s,"NZ",function(){return Me}),r.d(s,"ADD",function(){return _e}),r.d(s,"SUB",function(){return je}),r.d(s,"MUL",function(){return Ve}),r.d(s,"DIV",function(){return Fe}),r.d(s,"MOD",function(){return qe}),r.d(s,"SHL",function(){return We}),r.d(s,"SHR",function(){return Ye}),r.d(s,"BOOLAND",function(){return Xe}),r.d(s,"BOOLOR",function(){return Ge}),r.d(s,"NUMEQUAL",function(){return Ze}),r.d(s,"NUMNOTEQUAL",function(){return Qe}),r.d(s,"LT",function(){return $e}),r.d(s,"GT",function(){return et}),r.d(s,"LTE",function(){return tt}),r.d(s,"GTE",function(){return rt}),r.d(s,"MIN",function(){return nt}),r.d(s,"MAX",function(){return it}),r.d(s,"WITHIN",function(){return st}),r.d(s,"SHA1",function(){return ut}),r.d(s,"SHA256",function(){return ot}),r.d(s,"HASH160",function(){return at}),r.d(s,"HASH256",function(){return ct}),r.d(s,"CHECKSIG",function(){return dt}),r.d(s,"VERIFY",function(){return ht}),r.d(s,"CHECKMULTISIG",function(){return ft}),r.d(s,"ARRAYSIZE",function(){return lt}),r.d(s,"PACK",function(){return wt}),r.d(s,"UNPACK",function(){return St}),r.d(s,"PICKITEM",function(){return yt}),r.d(s,"SETITEM",function(){return pt}),r.d(s,"NEWARRAY",function(){return mt}),r.d(s,"NEWSTRUCT",function(){return At}),r.d(s,"NEWMAP",function(){return gt}),r.d(s,"APPEND",function(){return Et}),r.d(s,"REVERSE",function(){return bt}),r.d(s,"REMOVE",function(){return Dt}),r.d(s,"HASKEY",function(){return Ht}),r.d(s,"KEYS",function(){return Ct}),r.d(s,"VALUES",function(){return vt}),r.d(s,"THROW",function(){return Bt}),r.d(s,"THROWIFNOT",function(){return Pt});class u{constructor(e,t,r){this.label=e,this.hex=t,this.preset=r,u.values.push(this)}static fromHex(e){const t=u.values.find(t=>t.hex===e);if(void 0===t)throw new Error("Enum value not found");return t}static fromLabel(e){const t=u.values.find(t=>t.label===e);if(void 0===t)throw new Error("Enum value not found");return t}}u.values=[],u.SECP224R1=new u("P-224",1,"p224"),u.SECP256R1=new u("P-256",2,"p256"),u.SECP384R1=new u("P-384",3,"p384"),u.SECP521R1=new u("P-521",4,"p521"),u.ED25519=new u("ed25519",25,"ed25519");var o=r(0),a=r(4);const c={algorithm:"ECDSA",parameters:{curve:"P-256"}},d=20;class h{constructor(e,t,r){this.label=e,this.hex=t,this.labelJWS=r,h.values.push(this)}static fromHex(e){const t=h.values.find(t=>t.hex===e);if(void 0===t)throw new Error("Enum value not found");return t}static fromLabel(e){const t=h.values.find(t=>t.label===e);if(void 0===t)throw new Error("Enum value not found");return t}static fromLabelJWS(e){const t=h.values.find(t=>t.labelJWS===e);if(void 0===t)throw new Error("Enum value not found");return t}}h.values=[],h.ECDSAwithSHA224=new h("SHA224withECDSA",0,"ES224"),h.ECDSAwithSHA256=new h("SHA256withECDSA",1,"ES256"),h.ECDSAwithSHA384=new h("SHA384withECDSA",2,"ES384"),h.ECDSAwithSHA512=new h("SHA512withECDSA",3,"ES512"),h.ECDSAwithSHA3_224=new h("SHA3-224withECDSA",4,"ES3-224"),h.ECDSAwithSHA3_256=new h("SHA3-256withECDSA",5,"ES3-256"),h.ECDSAwithSHA3_384=new h("SHA3-384withECDSA",6,"ES3-384"),h.ECDSAwithSHA3_512=new h("SHA3-512withECDSA",7,"ES3-512"),h.ECDSAwithRIPEMD160=new h("RIPEMD160withECDSA",8,"ER160"),h.EDDSAwithSHA512=new h("SHA512withEdDSA",10,"EDS512");class f{constructor(e,t,r){this.label=e,this.hex=t,this.defaultSchema=r,f.values.push(this)}static fromHex(e){const t=f.values.find(t=>t.hex===e);if(void 0===t)throw new Error("Enum value not found");return t}static fromLabel(e){const t=f.values.find(t=>t.label===e);if(void 0===t)throw new Error("Enum value not found");return t}}f.values=[],f.ECDSA=new f("ECDSA",18,h.ECDSAwithSHA256),f.EDDSA=new f("EDDSA",20,h.EDDSAwithSHA512);class l{constructor(e,t,r){"string"==typeof e&&(e=new Buffer(e,"hex")),this.key=e,void 0===t&&(t=f.fromLabel(c.algorithm)),void 0===r&&(r=new w(u.fromLabel(c.parameters.curve))),this.algorithm=t,this.parameters=r}computeHash(e,t){if(t===h.ECDSAwithSHA224){const t=Object(o.createHash)("sha224");return t.update(e),t.digest()}if(t===h.ECDSAwithSHA256){const t=Object(o.createHash)("sha256");return t.update(e),t.digest()}if(t===h.ECDSAwithSHA384){const t=Object(o.createHash)("sha384");return t.update(e),t.digest()}if(t===h.ECDSAwithSHA3_512||t===h.EDDSAwithSHA512){const t=Object(o.createHash)("sha512");return t.update(e),t.digest()}if(t===h.ECDSAwithRIPEMD160){const t=Object(o.createHash)("ripemd160");return t.update(e),t.digest()}if(t===h.ECDSAwithSHA3_224)return new Buffer(a.sha3_224.arrayBuffer(e));if(t===h.ECDSAwithSHA3_256)return new Buffer(a.sha3_256.arrayBuffer(e));if(t===h.ECDSAwithSHA3_384)return new Buffer(a.sha3_384.arrayBuffer(e));if(t===h.ECDSAwithSHA3_512)return new Buffer(a.sha3_512.arrayBuffer(e));throw new Error("Unsupported hash algorithm.")}isSchemaSupported(e){switch(e){case h.ECDSAwithSHA224:case h.ECDSAwithSHA256:case h.ECDSAwithSHA384:case h.ECDSAwithSHA512:case h.ECDSAwithSHA3_224:case h.ECDSAwithSHA3_256:case h.ECDSAwithSHA3_384:case h.ECDSAwithSHA3_512:case h.ECDSAwithRIPEMD160:return this.algorithm===f.ECDSA;case h.EDDSAwithSHA512:return this.algorithm===f.EDDSA;default:throw new Error("Unsupported signature schema.")}}}class w{static deserializeJson(e){return new w(u.fromLabel(e.curve))}constructor(e){this.curve=e}serializeJson(){return{curve:this.curve.label}}}var S=r(3),y=r(5),p=r(1);class m{constructor(e){this.reader=y.wrap(e,"utf-8",!0)}readByte(){return this.reader.readUint8()}readBytes(e){return new Buffer(this.reader.readBytes(e).toBuffer())}readUInt16(){return this.reader.readUint16()}readUInt32(){return this.reader.readUint32()}readUInt64(){return this.reader.readUint64()}readInt16(){return this.reader.readInt16()}readInt32(){return this.reader.readInt32()}readInt64(){return this.reader.readInt64()}position(){return this.reader.offset}length(){return this.reader.limit}seek(e,t){if("start"===t){const t=this.reader.offset;return this.reader.offset=e,t}if("relative"===t){const t=this.reader.offset;return this.reader.offset=t+e,t}throw new Error("Unsupported Whence")}readVarBytes(e){const t=this.readVarUInt(void 0!==e?p.fromNumber(e):void 0).toNumber();return this.readBytes(t)}readVarInt(e){const t=this.readByte();let r;switch(t){case 253:r=p.fromNumber(this.readUInt16());break;case 254:r=p.fromNumber(this.readUInt32());break;case 255:r=this.readUInt64();break;default:r=p.fromNumber(t)}return void 0!==e&&r.gt(e)?p.ZERO:r}readVarUInt(e){const t=this.readByte();let r;switch(t){case 253:r=p.fromNumber(this.readInt16());break;case 254:r=p.fromNumber(this.readInt32());break;case 255:r=this.readInt64();break;default:r=p.fromNumber(t)}return void 0!==e&&r.gt(e)?p.ZERO:r}readVarString(e){return this.readVarBytes(e).toString("utf-8")}}class A{constructor(){this.writer=new y(void 0,!0,!0)}getBytes(){this.writer.mark(),this.writer.flip();const e=new Buffer(this.writer.toBuffer());return this.writer.reset(),e}writeVarUint(e){"number"==typeof e&&(e=p.fromNumber(e)),e.lt(253)?this.writer.writeUint8(e.toNumber()):e.lte(65535)?(this.writer.writeUint8(253),this.writer.writeUint16(e.toNumber())):e.lte(4294967295)?(this.writer.writeUint8(254),this.writer.writeUint32(e.toNumber())):(this.writer.writeUint8(255),this.writer.writeUint64(e))}writeVarBytes(e){this.writeVarUint(e.length),this.writeBytes(e)}writeString(e){return this.writeVarBytes(new Buffer(e,"utf-8"))}writeBytes(e){this.writer.append(e)}writeUint8(e){this.writer.writeUint8(e)}writeUint16(e){this.writer.writeUint16(e)}writeUint32(e){this.writer.writeUint32(e)}writeUint64(e){this.writer.writeUint64(e)}}class g extends l{static deserialize(e){const t=new m(e);if(33===e.length){const e=f.ECDSA,r=u.SECP256R1,n=t.readBytes(33);return new g(n,e,new w(r))}{const e=t.readByte(),r=t.readByte(),n=t.readBytes(t.length()-2);return new g(n,f.fromHex(e),new w(u.fromHex(r)))}}static compare(e,t){if(e.algorithm!==t.algorithm)return e.algorithm.hex-t.algorithm.hex;switch(e.algorithm){case f.ECDSA:const r=new S.ec(e.parameters.curve.preset),n=r.keyFromPublic(e.key,"hex"),i=r.keyFromPublic(t.key,"hex"),s=n.getPublic(),u=i.getPublic();return s.getX()!==u.getX()?s.getX()-u.getX():s.getY()-u.getY();case f.EDDSA:return Number(e.key.toString("hex"))-Number(t.key.toString("hex"));default:return 0}}serialize(){const e=new A;switch(this.algorithm){case f.ECDSA:e.writeBytes(this.key);break;case f.EDDSA:e.writeUint8(this.algorithm.hex),e.writeUint8(this.parameters.curve.hex),e.writeBytes(this.key)}return e.getBytes()}async verify(e,t){if(!this.isSchemaSupported(t.algorithm))throw new Error("Signature schema does not match key type.");e instanceof Buffer||(e=e.getSignContent());const r=this.computeHash(e,t.algorithm);return this.verifySignature(r,t.value,t.algorithm)}verifySignature(e,t,r){switch(r){case h.ECDSAwithSHA224:case h.ECDSAwithSHA256:case h.ECDSAwithSHA384:case h.ECDSAwithSHA512:case h.ECDSAwithSHA3_224:case h.ECDSAwithSHA3_256:case h.ECDSAwithSHA3_384:case h.ECDSAwithSHA3_512:case h.ECDSAwithRIPEMD160:return this.verifyEcDSASignature(e,t);case h.EDDSAwithSHA512:return this.verifyEdDSASignature(e,t);default:throw new Error("Unsupported signature schema.")}}verifyEcDSASignature(e,t){const r=t.slice(0,32),n=t.slice(32,64);return new S.ec(this.parameters.curve.preset).verify(e,{r:r,s:n},this.key,"hex")}verifyEdDSASignature(e,t){const r=t.slice(0,64),n=t.slice(64,64);return new S.eddsa(this.parameters.curve.preset).verify(e,{r:r,s:n},this.key,"hex")}}class E{static deserialize(e){if(e.length<2)throw new Error("Invalid params.");if(64===e.length){const t=h.ECDSAwithSHA256;return new E(t,e)}{const t=new m(e),r=t.readByte(),n=h.fromHex(r),i=t.readBytes(t.length()-t.position());return new E(n,i)}}constructor(e,t){this.algorithm=e,this.value=t}serialize(){const e=new A;return e.writeUint8(this.algorithm.hex),e.writeBytes(this.value),e.getBytes()}}class b extends l{static random(e,t){return void 0===e&&(e=f.ECDSA),void 0===t&&(t=new w(u.SECP256R1)),new b(Object(o.randomBytes)(32),e,t)}static deserialize(e){const t=new m(e);if(32===e.length){const e=f.ECDSA,r=u.SECP256R1,n=t.readBytes(32);return new b(n,e,new w(r))}{const e=t.readByte(),r=t.readByte(),n=t.readBytes(32);return new b(n,f.fromHex(e),new w(u.fromHex(r)))}}getPublicKey(){switch(this.algorithm){case f.ECDSA:return this.getEcDSAPublicKey();case f.EDDSA:return this.getEdDSAPublicKey();default:throw new Error("Unsupported signature schema.")}}async sign(e,t){if(void 0===t&&(t=this.algorithm.defaultSchema),!this.isSchemaSupported(t))throw new Error("Signature schema does not match key type.");e instanceof Buffer||(e=e.getSignContent());const r=this.computeHash(e,t),n=this.computeSignature(r,t);return new E(t,n)}computeSignature(e,t){switch(t){case h.ECDSAwithSHA224:case h.ECDSAwithSHA256:case h.ECDSAwithSHA384:case h.ECDSAwithSHA512:case h.ECDSAwithSHA3_224:case h.ECDSAwithSHA3_256:case h.ECDSAwithSHA3_384:case h.ECDSAwithSHA3_512:case h.ECDSAwithRIPEMD160:return this.computeEcDSASignature(e);case h.EDDSAwithSHA512:return this.computeEdDSASignature(e);default:throw new Error("Unsupported signature schema.")}}computeEcDSASignature(e){const t=new S.ec(this.parameters.curve.preset).sign(e,this.key,{canonical:!0,pers:void 0});return Buffer.concat([t.r.toArrayLike(Buffer,"be",32),t.s.toArrayLike(Buffer,"be",32)])}computeEdDSASignature(e){const t=new S.eddsa(this.parameters.curve.preset).sign(e,this.key,null);return Buffer.concat([t.R.toArrayLike(Buffer,"be",32),t.S.toArrayLike(Buffer,"be",32)])}getEcDSAPublicKey(){const e=new S.ec(this.parameters.curve.preset).keyFromPrivate(this.key,"hex").getPublic(!0,"hex");return new g(e,this.algorithm,this.parameters)}getEdDSAPublicKey(){const e=new S.eddsa(this.parameters.curve.preset).keyFromSecret(this.key,"hex").getPublic(!0,"hex");return new g(e,this.algorithm,this.parameters)}}var D=r(6);function H(e){const t=Object(o.createHash)("sha256");return t.update(e),t.digest()}function C(e){const t=Object(o.createHash)("ripemd160");return t.update(e),t.digest()}var v=r(2);function B(e){let t=e.toArray(256).value;if(e.isZero())return new Buffer("");const r=t[0];if(e.isNegative()){for(let e=0;e<t.length;e++)t[e]=255^t[e];t=(t=v.fromArray(t,256).add(v.one).toArray(256).value).reverse(),r>>7==1&&(t=t.concat(255))}else t=t.reverse(),r>>7==1&&(t=t.concat(0));return new Buffer(t)}function P(e){if(0===e.length)return v.zero;let t=Array.from(e.subarray(0));if((t=t.reverse())[0]>>7==1){for(let e=0;e<t.length;e++)t[e]=255^t[e];return t=v.fromArray(t,256).add(v(1)).toArray(256).value,v.fromArray(t,256).negate()}return v.fromArray(t,256)}const U=0,O=U,x=1,K=75,k=76,I=77,N=78,T=79,L=81,R=L,z=82,J=83,M=84,_=85,j=86,V=87,F=88,q=89,W=90,Y=91,X=92,G=93,Z=94,Q=95,$=96,ee=97,te=98,re=99,ne=100,ie=101,se=102,ue=103,oe=104,ae=105,ce=106,de=107,he=108,fe=109,le=114,we=115,Se=116,ye=117,pe=118,me=119,Ae=120,ge=121,Ee=122,be=123,De=124,He=125,Ce=126,ve=127,Be=128,Pe=129,Ue=130,Oe=131,xe=132,Ke=133,ke=134,Ie=135,Ne=139,Te=140,Le=141,Re=143,ze=144,Je=145,Me=146,_e=147,je=148,Ve=149,Fe=150,qe=151,We=152,Ye=153,Xe=154,Ge=155,Ze=156,Qe=158,$e=159,et=160,tt=161,rt=162,nt=163,it=164,st=165,ut=167,ot=168,at=169,ct=170,dt=172,ht=173,ft=174,lt=192,wt=193,St=194,yt=195,pt=196,mt=197,At=198,gt=199,Et=200,bt=201,Dt=202,Ht=203,Ct=204,vt=205,Bt=240,Pt=241;class Ut{constructor(){this.w=new A}pushPubKey(e){this.pushBytes(e.serialize())}writeOpCode(e){this.w.writeUint8(e)}writeByte(e){this.w.writeUint8(e)}writeBytes(e){this.w.writeBytes(e)}writeVarUInt(e){this.w.writeVarUint(e)}pushBytes(e){e.length<=K+1-x?this.w.writeUint8(e.length+x-1):e.length<256?(this.w.writeUint8(k),this.w.writeUint8(e.length)):e.length<65536?(this.w.writeUint8(I),this.w.writeUint16(e.length)):(this.w.writeUint8(N),this.w.writeUint32(e.length)),this.w.writeBytes(e)}pushNum(e){"number"==typeof e&&(e=p.fromNumber(e)),e.eq(-1)?this.writeOpCode(T):e.isZero()?this.writeOpCode(U):e.gt(0)&&e.lt(16)?this.writeOpCode(e.toNumber()-1+L):this.pushBytes(B(v(e.toString())))}pushBool(e){e?this.writeOpCode(R):this.writeOpCode(O)}getProgram(){return this.w.getBytes()}}function Ot(e){const t=new Ut;return t.pushPubKey(e),t.writeOpCode(dt),t.getProgram()}function xt(e,t){if(1===e)return Ot(t[0]);const r=t.length;if(!(1<=e&&e<=r&&r<=1024))throw new Error("Wrong multi-sig param");t.sort(g.compare);const n=new Ut;return n.pushNum(e),t.forEach(e=>{n.pushPubKey(e)}),n.pushNum(r),n.writeOpCode(ft),n.getProgram()}function Kt(e){const t=new Ut;for(const r of e)t.pushBytes(r);return t.getProgram()}class kt{static deserialize(e){const t=new m(e);try{const e=t.readBytes(d);return new kt(e)}catch(e){throw new Error("deserialize Uint256 error")}}static fromVmCode(e){return new kt(C(H(e)))}static fromPubKey(e){const t=Ot(e);return kt.fromVmCode(t)}static fromBase58(e){const t=D.decode(e),r=new Buffer(t).slice(1,21),n=new kt(r);if(e!==n.toBase58())throw new Error("[Address.fromBase58] decode encoded verify failed");return n}constructor(e="0000000000000000000000000000000000000000"){this.value="string"==typeof e?new Buffer(e,"hex"):e}equals(e){return this.value.equals(e.value)}serialize(e){e.writeBytes(this.value)}toArray(){const e=new Buffer(this.value.length);return this.value.copy(e),e}toBase58(){const e=Buffer.concat([new Buffer("17","hex"),this.value]),t=H(H(e)).slice(0,4),r=Buffer.concat([e,t]);return D.encode(r)}toOntId(){return"did:ont:"+this.toBase58()}}var It=r(7),Nt=r(8),Tt=r(9);function Lt(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}const Rt={N:4096,r:8,p:8,keyLength:64},zt=64;function Jt(e,t,r,n,i){const{keyLength:s}=i,u=Lt(i,["keyLength"]),a=Buffer.from(e,"base64"),c=a.slice(0,a.length-16),d=a.slice(a.length-16),h=_t(n.normalize("NFC"),r,s,u),f=h.slice(0,12),l=h.slice(32),w=f,S=new Buffer(t),y=Object(o.createDecipheriv)("aes-256-gcm",l,w);y.setAAD(S),y.setAuthTag(d);let p=y.update(c).toString("hex");try{p+=y.final().toString("hex")}catch(e){throw new Error("Password incorrect")}return p}function Mt(e,t,r,n,i){const{keyLength:s}=i,u=Lt(i,["keyLength"]),a=_t(n.normalize("NFC"),r,s,u),c=a.slice(0,12),d=a.slice(32),h=c,f=new Buffer(t),l=Object(o.createCipheriv)("aes-256-gcm",d,h);l.setAAD(f);let w=l.update(e);const S=l.final(),y=l.getAuthTag();return w=Buffer.concat([w,S]),Buffer.concat([w,y]).toString("base64")}function _t(e,t,r,n){let i=[];const s=Array.from(t.subarray(0));return Tt(e.normalize("NFC"),s,{N:n.N,r:n.r,p:n.p,dkLen:r},e=>{i=e}),new Buffer(i)}const jt="m/44'/1024'/0'/0/0";class Vt{constructor(){this["enc-alg"]="aes-256-gcm",this.hash="sha256"}static import(e,t,r,n=Object(o.randomBytes)(16),i=Rt){const s=new Vt;if(e||(e=Object(o.randomBytes)(4).toString("hex")),s.label=e,s.lock=!1,s.isDefault=!1,s.salt=n.toString("base64"),s.scrypt=i,s.publicKey=t.getPublicKey(),s.address=kt.fromPubKey(s.publicKey),s.encryptedKey=Mt(t.key,s.address.toBase58(),n,r,i),!s.address.equals(s.address))throw new Error("Computed address does not match the provided address.");return s}static importMnemonic(e,t,r,n=Rt){if(t=t.trim(),!Object(It.validateMnemonic)(t))throw new Error("Invalid mnemonics");const i=Object(It.toSeedHex)(t),s=Nt.HDKey.fromMasterSeed(Buffer.from(i,"hex")).derive(jt),u=Buffer.from(s.privateKey).toString("hex"),o=new b(u);return Vt.create(e,o,r,n)}static create(e,t,r,n=Rt){const i=new Vt,s=Object(o.randomBytes)(16),u=t.getPublicKey(),a=kt.fromPubKey(u);return i.label=e,i.lock=!1,i.isDefault=!1,i.publicKey=u,i.address=a,i.encryptedKey=Mt(t.key,a.toBase58(),s,r,n),i.salt=s.toString("base64"),i.scrypt=n,i}static deserializeJson(e,t=Rt){"string"==typeof e&&(e=JSON.parse(e));const r=new g(new Buffer(e.publicKey,"hex"),f.fromLabel(e.algorithm),w.deserializeJson(e.parameters)),n=new Vt;return n.address=kt.fromBase58(e.address),n.label=e.label,n.lock=e.lock,n.isDefault=e.isDefault,n.publicKey=r,n.hash=e.hash,n.salt=e.salt,n.encryptedKey=e.key,n.extra=e.extra,n.scrypt=t,n}serializeJson(e=!1){const t={address:this.address.toBase58(),label:this.label,lock:this.lock,extra:this.extra,key:this.encryptedKey,"enc-alg":this["enc-alg"],hash:this.hash,salt:this.salt,isDefault:this.isDefault,publicKey:this.publicKey.serialize().toString("hex"),algorithm:this.publicKey.algorithm.label,parameters:this.publicKey.parameters.serializeJson()};return e?JSON.stringify(t):t}decryptKey(e){const t=Buffer.from(this.salt,"base64"),r=Jt(this.encryptedKey,this.address.toBase58(),t,e,this.scrypt);return new b(r,this.publicKey.algorithm,this.publicKey.parameters)}}class Ft{constructor(){this.controls=[]}static importIdentity(e,t,r,n=Object(o.randomBytes)(16),i=Rt){const s=new Ft;e||(e=Object(o.randomBytes)(4).toString("hex"));const u=t.getPublicKey(),a=kt.fromPubKey(u),c={id:"1",encryptedKey:Mt(t.key,a.toBase58(),n,r,i),address:a,salt:n.toString("base64"),hash:"sha256","enc-alg":"aes-256-gcm",publicKey:u,scrypt:i};return s.label=e,s.lock=!1,s.isDefault=!1,s.ontid=kt.fromPubKey(u).toOntId(),s.controls=[c],s.scrypt=i,s}static create(e,t,r,n=Rt){const i=new Ft,s=Object(o.randomBytes)(16),u=t.getPublicKey(),a=kt.fromPubKey(u),c={id:"1",encryptedKey:Mt(t.key,a.toBase58(),s,r,n),address:a,salt:s.toString("base64"),hash:"sha256","enc-alg":"aes-256-gcm",publicKey:u};return i.label=e,i.lock=!1,i.isDefault=!1,i.ontid=kt.fromPubKey(u).toOntId(),i.controls=[c],i.scrypt=n,i}static deserializeControlsJson(e){return e.map(e=>{const t=new g(new Buffer(e.publicKey,"hex"),f.fromLabel(e.algorithm),w.deserializeJson(e.parameters));return{id:e.id,encryptedKey:e.key,address:kt.fromBase58(e.address),salt:e.salt,hash:e.hash,"enc-alg":e["enc-alg"],publicKey:t}})}static deserializeJson(e,t=Rt){"string"==typeof e&&(e=JSON.parse(e));const r=new Ft;return r.label=e.label,r.lock=e.lock,r.ontid=e.ontid,r.isDefault=e.isDefault,r.extra=e.extra,r.controls=Ft.deserializeControlsJson(e.controls),r.scrypt=t,r}serializeControlsJson(e=!1){const t=this.controls.map(e=>({key:e.encryptedKey,id:e.id,address:e.address.toBase58(),salt:e.salt,"enc-alg":e["enc-alg"],hash:e.hash,publicKey:e.publicKey.serialize().toString("hex"),algorithm:e.publicKey.algorithm.label,parameters:e.publicKey.parameters.serializeJson()}));return e?JSON.stringify(t):t}serializeJson(e=!1){const t={ontid:this.ontid,label:this.label,lock:this.lock,isDefault:this.isDefault,extra:this.extra,controls:this.serializeControlsJson(!1)};return e?JSON.stringify(t):t}decryptKey(e,t){const r=this.controls.find(t=>t.id===e);if(void 0===r)throw new Error("ControlData not found.");const n=Buffer.from(r.salt,"base64"),i=Jt(r.encryptedKey,r.address.toBase58(),n,t,this.scrypt);return new b(i,r.publicKey.algorithm,r.publicKey.parameters)}}class qt{static constructAddress(e){let t;return t="string"==typeof e?40===e.length?new kt(e):kt.fromBase58(e):e}static create(){const e=new qt;return e.name=name,e.accounts=[],e.identities=[],e.createTime=(new Date).toISOString(),e.version="1.0",e.scrypt=Rt,e.keyLength=zt,e}static deserializeJson(e){"string"==typeof e&&(e=JSON.parse(e));const t=new qt;return t.name=e.name,t.defaultOntid=e.defaultOntid,t.defaultAccountAddress=e.defaultAccountAddress,t.createTime=e.createTime,t.version=e.version,t.scrypt={N:e.scrypt.n,r:e.scrypt.r,p:e.scrypt.p,keyLength:e.scrypt.dkLen},t.identities=void 0!==e.identities?e.identities.map(e=>Ft.deserializeJson(e,t.scrypt)):[],t.accounts=void 0!==e.accounts?e.accounts.map(e=>Vt.deserializeJson(e,t.scrypt)):[],t.extra=e.extra,t}addAccount(e){for(const t of this.accounts)if(t.address.equals(e.address))return;this.accounts.push(e)}delAccount(e){const t=qt.constructAddress(e);this.accounts=this.accounts.filter(e=>!e.address.equals(t))}getAccount(e){const t=qt.constructAddress(e);return this.accounts.find(e=>e.address.equals(t))}addIdentity(e){for(const t of this.identities)if(t.ontid===e.ontid)return;this.identities.push(e)}delIdentity(e){this.identities=this.identities.filter(t=>!(t.ontid===e))}getIdentity(e){return this.identities.find(t=>t.ontid===e)}setDefaultAccount(e){this.defaultAccountAddress=e}setDefaultIdentity(e){this.defaultOntid=e}serializeJson(e=!1){const t={name:this.name,defaultOntid:this.defaultOntid,defaultAccountAddress:this.defaultAccountAddress,createTime:this.createTime,version:this.version,scrypt:{n:this.scrypt.N,r:this.scrypt.r,p:this.scrypt.p,dkLen:this.scrypt.keyLength},identities:this.identities.map(e=>e.serializeJson(!1)),accounts:this.accounts.map(e=>e.serializeJson(!1)),extra:null};return e?JSON.stringify(t):t}}r.d(t,"CurveLabel",function(){return u}),r.d(t,"Key",function(){return l}),r.d(t,"PublicKey",function(){return g}),r.d(t,"PrivateKey",function(){return b}),r.d(t,"Signature",function(){return E}),r.d(t,"SignatureScheme",function(){return h}),r.d(t,"KeyType",function(){return f}),r.d(t,"Address",function(){return kt}),r.d(t,"Account",function(){return Vt}),r.d(t,"Identity",function(){return Ft}),r.d(t,"Wallet",function(){return qt}),r.d(t,"ProgramBuilder",function(){return Ut}),r.d(t,"programFromMultiPubKeys",function(){return xt}),r.d(t,"programFromParams",function(){return Kt}),r.d(t,"programFromPubKey",function(){return Ot}),r.d(t,"Reader",function(){return m}),r.d(t,"Writer",function(){return A}),r.d(t,"OpCode",function(){return s}),r.d(t,"Hash",function(){return n}),r.d(t,"Serialize",function(){return i})}]);
//# sourceMappingURL=index.js.map